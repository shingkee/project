{% extends "@base/layouts/backend.twig" %}
{% import "@base/macros/options.twig" as options %}

{% block head %}
	<div class="sc-tabs">
		<a href="#" class="tab active" data-target="main">
			<i class="fa fa-cog"></i>{{ translate('Main') }}
		</a>
		<a href="#" class="tab" data-target="pages">
			<i class="fa fa-file-text-o"></i>{{ translate('Pages') }}
		</a>
		<a href="#" class="tab" data-target="security">
			<i class="fa fa-lock"></i>{{ translate('Security') }}
		</a>
		<a href="#" class="tab" data-target="uploads">
			<i class="fa fa-upload"></i>{{ translate('Uploads') }}
		</a>
		<a href="#" class="tab" data-target="seo">
			<i class="fa fa-search"></i>{{ translate('SEO') }}
		</a>
		<a href="#" class="tab" data-target="import">
			<i class="fa fa-download"></i>{{ translate('Import Data') }}
		</a>
        {{ environment.dispatcher.dispatch('backendSettingsMainContentTab') }}
	</div>
{% endblock %}

{% block mainHeader %}
	<div class="sc-header">
		<h2>{{ translate('Main') }}</h2>
		<button data-save-settings class="save-settings sc-button icon-button primary">
			<i class="fa fa-save"></i>
			<span>{{ translate('Save Settings') }}</span>
		</button>
	</div>
{% endblock %}

{% block main %}

	<div class="sc-tab-content active" data-tab="main">
		<div class="mp-options">
			<div class="row">
				<div class="col-md-12">

					{{ options.emailRowWithButton(
						translate('Admin Email'),
						options.button(
							translate('Send Test Email'),
							'admin-email-button',
							'tooltip'
						),
						'main[admin-email]',
						settings.main['admin-email'],
						'admin-email'
					) }}

					{{ options.radioRow(
						translate('Messages'),
						[{
							'label': translate('Yes'),
							'name': 'main[messages]',
							'value': 'true',
							'checked': settings.main.messages == 'true'
						},
						{
							'label': translate('No'),
							'name': 'main[messages]',
							'value': 'false',
							'checked': settings.main.messages == 'false'
						}],
						'messages'
					) }}

					{{ options.radioRow(
						translate('Groups'),
						[{
							'label': translate('Yes'),
							'name': 'main[groups]',
							'value': 'true',
							'checked': settings.main.groups == 'true'
						},
						{
							'label': translate('No'),
							'name': 'main[groups]',
							'value': 'false',
							'checked': settings.main.groups == 'false'
						}], 
						'groups'
					) }}

					{{ options.radioRow(
						translate('Friends'),
						[{
							'label': translate('Yes'),
							'name': 'main[friends]',
							'value': 'true',
							'checked': settings.main.friends == 'true'
						},
						{
							'label': translate('No'),
							'name': 'main[friends]',
							'value': 'false',
							'checked': settings.main.friends == 'false'
						}],
						'friends'
					) }}

					{{ options.radioRow(
						translate('Activity'),
						[{
							'label': translate('Yes'),
							'name': 'main[activity]',
							'value': 'true',
							'checked': settings.main.activity == 'true'
						},
						{
							'label': translate('No'),
							'name': 'main[activity]',
							'value': 'false',
							'checked': settings.main.activity == 'false'
						}],
						'activity'
					) }}

					{{ options.radioRow(
					translate('Followers'),
					[{
						'label': translate('Yes'),
						'name': 'main[followers]',
						'value': 'true',
						'checked': settings.main.followers == 'true'
					},
					{
						'label': translate('No'),
						'name': 'main[followers]',
						'value': 'false',
						'checked': settings.main.followers == 'false'
					}],
					'followers'
					) }}

                    {{ options.radioRow(
                    translate('Posts'),
                    [{
                        'label': translate('Yes'),
                        'name': 'main[posts]',
                        'value': 'true',
                        'checked': settings.main.posts == 'true'
                    },
                    {
                        'label': translate('No'),
                        'name': 'main[posts]',
                        'value': 'false',
                        'checked': settings.main.posts == 'false'
                    }],
                    'posts'
                    ) }}

                    {{ options.radioRow(
                    translate('Comments'),
                    [{
                        'label': translate('Yes'),
                        'name': 'main[comments]',
                        'value': 'true',
                        'checked': settings.main.comments == 'true'
                    },
                    {
                        'label': translate('No'),
                        'name': 'main[comments]',
                        'value': 'false',
                        'checked': settings.main.comments == 'false'
                    }],
                    'comments'
                    ) }}

                    {{ environment.dispatcher.dispatch('adminMainSettingsOptions') }}

					{{ options.radioRowWithInput(
						translate('Redirect after registration to'),
						[{
							'label': translate('Profile'),
							'name': 'main[after-registration-action]',
							'value': 'redirect-to-profile',
							'checked': settings.main['after-registration-action'] == 'redirect-to-profile'
						},
						{
							'label': translate('URL'),
							'name': 'main[after-registration-action]',
							'value': 'redirect-to-url',
							'checked': settings.main['after-registration-action'] == 'redirect-to-url'
						}],
						'after-registration-action',
						'',
						options.textInput(
							'main[after-registration-redirect-url]',
							settings.main['after-registration-redirect-url']
						)
					) }}

					{{ options.radioRowWithInput(
						translate('Redirect after login to'),
						[{
							'label': translate('Profile'),
							'name': 'main[after-login-action]',
							'value': 'redirect-to-profile',
							'checked': settings.main['after-login-action'] == 'redirect-to-profile'
						},
						{
							'label': translate('URL'),
							'name': 'main[after-login-action]',
							'value': 'redirect-to-url',
							'checked': settings.main['after-login-action'] == 'redirect-to-url'
						}],
						'after-login-action',
						'',
						options.textInput(
							'main[after-login-action-redirect-url]',
							settings.main['after-login-action-redirect-url']
						)
					) }}

					{{ options.radioRowWithInput(
						translate('Redirect after logout to'),
						[{
							'label': translate('Main'),
							'name': 'main[after-logout-action]',
							'value': 'redirect-to-main',
							'checked': settings.main['after-logout-action'] == 'redirect-to-main'
						},
						{
							'label': translate('URL'),
							'name': 'main[after-logout-action]',
							'value': 'redirect-to-url',
							'checked': settings.main['after-logout-action'] == 'redirect-to-url'
						}],
						'after-logout-action',
						'',
						options.textInput(
							'main[after-logout-action-redirect-url]',
							settings.main['after-logout-action-redirect-url']
						)
					) }}

					{{ options.radioRowWithInput(
						translate('Redirect after account is deleted to'),
						[{
							'label': translate('Main'),
							'name': 'main[after-delete-account-action]',
							'value': 'redirect-to-main',
							'checked': settings.main['after-delete-account-action'] == 'redirect-to-main'
						},
						{
							'label': translate('URL'),
							'name': 'main[after-delete-account-action]',
							'value': 'redirect-to-url',
							'checked': settings.main['after-delete-account-action'] == 'redirect-to-url'
						}],
						'after-delete-account-action',
						'',
						options.textInput(
						'main[after-delete-account-action-redirect-url]',
						settings.main['after-delete-account-action-redirect-url']
						)
					) }}

				</div>
			</div>
		</div>
	</div>
    <div class="sc-tab-content" data-tab="pages">
        <div class="mp-action-panel">
            <button class="create-pages sc-button icon-button primary">
                <i class="fa fa-plus"></i>
                <span>{{ translate('Create all unassigned pages') }}</span>
            </button>
            <button class="save-pages sc-button icon-button primary">
                <i class="fa fa-save"></i>
                <span>{{ translate('Save Pages') }}</span>
            </button>
        </div>
        <div class="mp-options">
            <div class="row">
                <div class="col-md-12">
                    {% for slug, page in pages %}
						{% if slug == 'contact_form' %}
							{{ environment.dispatcher.dispatch('backendSettingsMainPagesTab', [  settings.pages ]) }}
						{% else %}
							<div class="mp-option mp-page-option" data-page-slug="{{ slug }}">
								<div class="row">
									<div class="col-md-4">
										<div class="mp-option-label">
											<span title="{{ page.title }}">{{ page.title }}</span>
										</div>
									</div>
									<div class="col-md-8">
										<div class="mp-option-input-with-button">
											<div class="mp-option-button" {% if (page.id) %}style="display: none"{% endif %}>
												<button class="sc-button icon-button create-page-button primary" data-page-slug="{{ slug }}">
													<i class="fa fa-plus"></i>
													<span>{{ translate('Create page') }}</span>
												</button>
											</div>
											<div class="mp-option-select">
												{{ function('wp_dropdown_pages', {'name': 'pages[' ~ slug ~ ']', 'selected': page.id, 'class': 'sc-input wp-pages-list', 'echo': false, 'show_option_none': 'Select Page', 'option_none_value': '__none'})|raw }}
											</div>
										</div>
									</div>
								</div>
							</div>
						{% endif %}
                    {% endfor %}

                </div>
            </div>
        </div>

    </div>
	<div class="sc-tab-content" data-tab="security">
		<div class="mp-options">
			<div class="row">
				<div class="col-md-12">

					{{ options.radioRow(translate('Global Site Access'), 
						[{
							'label': translate('Site Accessible to Everyone'),
							'name': 'security[global-site-access]',
							'value': 'everyone',
							'checked': settings.security['global-site-access'] == 'everyone'
						},
						{
							'label': translate('Site Accessible to Logged In Users'),
							'name': 'security[global-site-access]',
							'value': 'logged-in-users',
							'checked': settings.security['global-site-access'] == 'logged-in-users'
						}], 
						'global-site-access'
					) }}

                    {{ options.radioRow(translate('Protect all Pages'),
						[{
							'label': translate('Yes'),
							'name': 'security[protect-all-pages]',
							'value': 'yes',
							'checked': settings.security['protect-all-pages'] == 'yes'
						},
						{
							'label': translate('No'),
							'name': 'security[protect-all-pages]',
							'value': 'no',
							'checked': settings.security['protect-all-pages'] == 'no'
						}],
						'protect-all-pages'
                    ) }}

					{{ options.row(translate('Redirect from backend login screen to membership login page'), 
						options.radioInput([{
							'label': translate('Yes'),
							'name': 'security[backend-login-screen-redirect]',
							'value': 'yes',
							'checked': settings.security['backend-login-screen-redirect'] == 'yes'
						},
						{
							'label': translate('No'),
							'name': 'security[backend-login-screen-redirect]',
							'value': 'no',
							'checked': settings.security['backend-login-screen-redirect'] == 'no'
						}]), 
						'backend-login-screen-redirect'
					) }}

					{{ options.textareaRow(translate('Blocked IP Addresses'),
						'security[blocked-ip]',
						settings.security['blocked-ip']|default(templates.get('blocked-ip')),
						'blocked-ip'
					) }}

				</div>
			</div>
		</div>
	</div>
	<div class="sc-tab-content" data-tab="uploads">
		<div class="mp-options">
			<div class="row">
				<div class="col-md-12">
					<div class="mp-option" id="max-image-size">
						<div class="row">
							<div class="col-md-4">
								{{ options.label(translate('Maximum Image Size')) }}
							</div>
							<div class="col-md-8">
								<div class="mp-option-sizes-input">
									<div class="mp-option-input">
										<input class="sc-input" value="{{ settings.uploads['max-image-size'].width }}" name="uploads[max-image-size][width]">
									</div>
									<span>x</span>
									<div class="mp-option-input">
										<input class="sc-input" value="{{ settings.uploads['max-image-size'].height }}" name="uploads[max-image-size][height]">
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="mp-option-input">
						<input type="hidden"
							   class="sc-input"
							   name="uploads[max-file-size]"
							   value="{{ settings.uploads['max-file-size'] }}"
							   max="{{ maxFileUpload }}"
						>
					</div>

					{{ options.inputRow(
						translate('Maximum File Size (Mb)'),
						'uploads[max-file-size-mb]',
						settings.uploads['max-file-size'] / (1024 * 1024),
						'max-file-size-mb',
						'',
						'max="' ~ maxFileUpload / (1024 * 1024) ~ '"'
					) }}
					<div class="col-md-4">
					</div>
					<div class="col-md-8">
						<div class="mp-option-input-description">
							<div class="description">
								<span>{{ translate('Maximum available file upload size is %d Mb')|format(maxFileUpload / (1024 * 1024)) }}</span>
							</div>
						</div>
					</div>

					{{ options.inputRow(translate('Image Quality'),
						'uploads[image-quality]',
						settings.uploads['image-quality'],
						'image-quality'
					) }}

				</div>
			</div>
		</div>
	</div>
	<div class="sc-tab-content" data-tab="seo">
		<div class="mp-options">
			<div class="row">
				<div class="col-md-12">

					{{ options.inputRow(translate('User Profile Title'),
						'seo[profile-title]',
						settings.seo['profile-title'],
						'profile-title'
					) }}

					{{ options.textareaRow(translate('User Profile Dynamic Meta Description'),
						'seo[profile-description]',
						settings.seo['profile-description']|default(templates.get('profile-description')),
						'profile-description'
					) }}

					{{ options.inputRow(translate('Group Title'),
						'seo[group-title]',
						settings.seo['group-title'],
						'group-title'
					) }}

					{{ options.textareaRow(translate('Group Dynamic Meta Description'),
						'seo[group-description]',
						settings.seo['group-description']|default(templates.get('group-description')),
						'group-description'
					) }}

				</div>
			</div>
		</div>
	</div>
	<div class="sc-tab-content" data-tab="import">
		<div class="mp-options">
			<div class="row">
				<div class="col-md-12">
	
					{% if isBuddyPressExists %}
						<h3 class="header">BuddyPress</h3>
						<div class="mp-option">
							<label class="sc-checkbox">
								<input type="checkbox" id="bp-fields" value="true" checked="checked">
								<div class="sc-checkbox-state"></div>
							</label>
							<label for="bp-fields">{{ translate('Import User Fields') }}</label>
						</div>
						<div class="mp-option">
							<label class="sc-checkbox">
								<input type="checkbox" id="bp-groups" value="true" checked="checked">
								<div class="sc-checkbox-state"></div>
							</label>
							<label for="bp-groups">{{ translate('Import Groups') }}</label>
						</div>
						<div class="mp-option">
							<label class="sc-checkbox">
								<input type="checkbox" id="bp-friends" value="true" checked="checked">
								<div class="sc-checkbox-state"></div>
							</label>
							<label for="bp-friends">{{ translate('Import Friends') }}</label>
						</div>
						<div class="mp-option">
							<label class="sc-checkbox">
								<input type="checkbox" id="bp-activity" value="true" checked="checked">
								<div class="sc-checkbox-state"></div>
							</label>
							<label for="bp-activity">{{ translate('Import Activity') }}</label>
						</div>
						
						<div style="margin: 2em 0">
							<button class="import-buddy-press-data sc-button icon-button primary">
								<i class="fa fa-plus-circle"></i>
								<span>{{ translate('Import Buddy Press Data') }}</span>
							</button>
						</div>
					{% endif %}
					
					{% if isUltimateMemberExists %}
						<h3 class="header">Ultimate Member</h3>
						<div class="mp-option">
							<label class="sc-checkbox">
								<input type="checkbox" id="um-fields" value="true" checked="checked">
								<div class="sc-checkbox-state"></div>
							</label>
							<label for="bp-fields">{{ translate('Import User Fields') }}</label>
						</div>
						
						<div style="margin: 2em 0">
							<button class="import-ultimate-member-data sc-button icon-button primary">
								<i class="fa fa-plus-circle"></i>
								<span>{{ translate('Import Ultimate Member Data') }}</span>
							</button>
						</div>
					{% endif %}
					
					{% if not isBuddyPressExists and not isUltimateMemberExists %}
						{{ translate('No supported plugins found. Currently we support:') }} BuddyPress, Ultimate Member.
					{% endif %}

				</div>
			</div>
		</div>
	</div>

    {{ environment.dispatcher.dispatch('backendSettingsMainContentSettings') }}
{% endblock %}